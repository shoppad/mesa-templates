{
    "key": "shopify/order/send_order_report_card_email",
    "name": "Receive a Daily Order Report Card Email for Shopify",
    "version": "2.0.3",
    "enabled": false,
    "setup": true,
    "config": {
        "inputs": [
            {
                "schema": 2,
                "trigger_type": "input",
                "type": "schedule",
                "name": "Schedule",
                "key": "schedule",
                "operation_id": "schedule",
                "metadata": {
                    "schedule": "@daily:0 8 * * *",
                    "enqueue_type": "schedule"
                },
                "local_fields": [],
                "selected_fields": [],
                "on_error": "default",
                "weight": 0
            }
        ],
        "outputs": [
            {
                "schema": 3.1,
                "trigger_type": "output",
                "type": "shopify",
                "entity": "order",
                "action": "list",
                "name": "Get List of Orders",
                "key": "shopify_order",
                "operation_id": "get_orders",
                "metadata": {
                    "api_endpoint": "get admin\/orders.json",
                    "query": {
                        "status": "any",
                        "created_at_min": "{{\"now\" | date: \"%Y-%m-%dT%H:%M:%S%z\" | subtract_time: 24, \"hours\" | date: \"%Y-%m-%dT%H:%M:%S%z\"}}",
                        "created_at_max": "{{\"now\" | date: \"%Y-%m-%dT%H:%M:%S%z\"}}"
                    }
                },
                "local_fields": [],
                "selected_fields": [
                    "query.status",
                    "query.limit",
                    "query.created_at_min",
                    "query.created_at_max"
                ],
                "on_error": "default",
                "weight": 0
            },
            {
                "schema": 3.1,
                "trigger_type": "output",
                "type": "shopify",
                "entity": "shop",
                "action": "list",
                "name": "Retrieve Shop",
                "key": "shopify_1",
                "operation_id": "get_shop",
                "metadata": {
                    "api_endpoint": "get admin\/shop.json"
                },
                "local_fields": [],
                "selected_fields": [],
                "on_error": "default",
                "weight": 1
            },
            {
                "schema": 3,
                "trigger_type": "output",
                "type": "transform",
                "entity": "mapping",
                "name": "Transform Mapping - Compile Order Data",
                "key": "transform_mapping",
                "operation_id": "mapping",
                "metadata": {
                    "mapping": [
                        {
                            "destination": "orders_total",
                            "source": "{{CALCULATED_IN_CODE}}"
                        },
                        {
                            "destination": "orders_over_100",
                            "source": "{{CALCULATED_IN_CODE}}"
                        },
                        {
                            "destination": "orders_paid",
                            "source": "{{CALCULATED_IN_CODE}}"
                        },
                        {
                            "destination": "orders_pending",
                            "source": "{{CALCULATED_IN_CODE}}"
                        },
                        {
                            "destination": "orders_fulfilled",
                            "source": "{{CALCULATED_IN_CODE}}"
                        },
                        {
                            "destination": "most_popular_product",
                            "source": "{{CALCULATED_IN_CODE}}"
                        },
                        {
                            "destination": "workflow_id",
                            "source": "{{CALCULATED_IN_CODE}}"
                        }
                    ],
                    "script": "compile_order_data.js"
                },
                "local_fields": [
                    {
                        "key": "mapping",
                        "type": "mapping",
                        "tokens": "brackets",
                        "location": "required"
                    }
                ],
                "selected_fields": [],
                "on_error": "default",
                "weight": 2
            },
            {
                "schema": 5,
                "trigger_type": "output",
                "type": "email",
                "name": "Send Email Report",
                "version": "v2",
                "key": "email",
                "operation_id": "/send-email",
                "metadata": {
                    "api_endpoint": "post /send-email",
                    "body": {
                        "to": "{{ template | label: 'What email address should receive the daily order report card?', tokens: false, type: 'email' }}",
                        "subject": "Order Report Card for {{\"now\" | date: \"%Y-%m-%dT%H:%M:%S%z\" | date: \"%B %e, %Y\"}}",
                        "message": "<!DOCTYPE html\n  PUBLIC \"-\/\/W3C\/\/DTD XHTML 1.0 Transitional\/\/EN\" \"http:\/\/www.w3.org\/TR\/xhtml1\/DTD\/xhtml1-transitional.dtd\">\n<html xmlns=\"http:\/\/www.w3.org\/1999\/xhtml\" xmlns:v=\"urn:schemas-microsoft-com:vml\"\n  xmlns:o=\"urn:schemas-microsoft-com:office:office\">\n\n<head>\n  <!--[if gte mso 9]><xml><o:OfficeDocumentSettings><o:AllowPNG\/><o:PixelsPerInch>96<\/o:PixelsPerInch><\/o:OfficeDocumentSettings><\/xml><![endif]-->\n  <meta http-equiv=\"Content-type\" content=\"text\/html; charset=utf-8\" \/>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1\" \/>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" \/>\n  <meta name=\"format-detection\" content=\"date=no\" \/>\n  <meta name=\"format-detection\" content=\"address=no\" \/>\n  <meta name=\"format-detection\" content=\"telephone=no\" \/>\n  <meta name=\"x-apple-disable-message-reformatting\" \/>\n  <!--[if !mso]><!-->\n  <!--<![endif]-->\n  <title>Email Template<\/title>\n  <!--[if gte mso 9]><style type=\"text\/css\" media=\"all\">sup { font-size: 100% !important; }<\/style><![endif]-->\n  <style type=\"text\/css\" media=\"screen\">\n    body {\n      padding: 0 !important;\n      margin: 0 auto !important;\n      display: block !important;\n      min-width: 100% !important;\n      width: 100% !important;\n      background: #f6f7f9;\n      -webkit-text-size-adjust: none\n    }\n\n    a {\n      color: #42474e;\n      text-decoration: none\n    }\n\n    p {\n      padding: 0 !important;\n      margin: 0 !important\n    }\n\n    div {\n      background: transparent !important;\n    }\n\n    strong {\n      font-weight: 700 !important;\n    }\n\n    img {\n      margin: 0 !important;\n      -ms-interpolation-mode: bicubic;\n      \/* Allow smoother rendering of resized image in Internet Explorer *\/\n    }\n\n    #MessageViewBody,\n    #MessageWebViewDiv {\n      width: 100% !important;\n    }\n\n    \/* Samsung Galaxy Note 4 Samsung Mail - make email stay centered *\/\n    a[x-apple-data-detectors] {\n      color: inherit !important;\n      text-decoration: inherit !important;\n      font-size: inherit !important;\n      font-family: inherit !important;\n      font-weight: inherit !important;\n      line-height: inherit !important;\n    }\n\n    .btn-14 a {\n      display: block;\n      padding: 6px 12px;\n      text-decoration: none;\n    }\n\n    .l-red a {\n      color: #ff0000;\n    }\n\n    \/* Mobile styles *\/\n    @media only screen and (max-device-width: 480px),\n    only screen and (max-width: 480px) {\n      .main-table {\n        padding: 0 !important;\n      }\n\n      .mpx-0 {\n        padding-left: 0px !important;\n        padding-right: 0px !important;\n      }\n\n      .mpb-20 {\n        padding-bottom: 20px !important;\n      }\n\n      u+.body .gwfw {\n        width: 100% !important;\n        width: 100vw !important;\n      }\n\n      .td,\n      .m-shell {\n        width: 100% !important;\n        min-width: 100% !important;\n      }\n\n      .mt-left {\n        text-align: left !important;\n      }\n\n      .mt-center {\n        text-align: center !important;\n      }\n\n      .mt-right {\n        text-align: right !important;\n      }\n\n      .me-left {\n        margin-right: auto !important;\n      }\n\n      .me-center {\n        margin: 0 auto !important;\n      }\n\n      .me-right {\n        margin-left: auto !important;\n      }\n\n      .h-auto {\n        height: auto !important;\n      }\n\n      .w-auto {\n        width: auto !important;\n      }\n\n      .fluid-img img {\n        width: 100% !important;\n        max-width: 100% !important;\n        height: auto !important;\n      }\n\n      .column,\n      .column-top,\n      .column-dir,\n      .column-dir-top {\n        float: left !important;\n        width: 100% !important;\n        display: block !important;\n      }\n\n      .m-hide {\n        display: none !important;\n        width: 0 !important;\n        height: 0 !important;\n        font-size: 0 !important;\n        line-height: 0 !important;\n        min-height: 0 !important;\n      }\n\n      .m-block {\n        display: block !important;\n      }\n\n      \/*Width*\/\n      .w-15 {\n        width: 15px !important;\n      }\n\n      .hide-for-desktop {\n        display: block !important;\n        max-width: 100% !important;\n        max-height: 100% !important;\n        visibility: visible !important;\n        opacity: 1 !important;\n        width: auto !important;\n        height: auto !important;\n      }\n\n      .w-2p {\n        width: 2% !important;\n      }\n\n      .w-28p {\n        width: 28% !important;\n      }\n\n      .w-32p {\n        width: 32% !important;\n      }\n\n      .w-49p {\n        width: 49% !important;\n      }\n\n      .w-50p {\n        width: 50% !important;\n      }\n\n      .w-70p {\n        width: 70% !important;\n      }\n\n      .w-100p {\n        width: 100% !important;\n      }\n      \/*Text*\/\n    }\n  <\/style>\n<\/head>\n\n<body class=\"body\"\n  style=\"padding:0 !important; margin:0 auto !important; display:block !important; min-width:100% !important; width:100% !important; background:#f6f7f9; -webkit-text-size-adjust:none;\">\n  <center>\n    <table class=\"main-table\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin: 0; padding: 10px 0; width: 100%;\"\n      bgcolor=\"#f6f7f9\" class=\"gwfw\">\n      <tr>\n        <td style=\"margin: 0; padding: 0; width: 100%;\" align=\"center\">\n          <table width=\"460\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"m-shell\">\n            <tr>\n              <td class=\"td\"\n                style=\"width:690px; min-width:690px; font-size:0pt; line-height:0pt; padding:0; margin:0; font-weight:normal;\">\n                <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                  <tr>\n                    <td class=\"px-20 mpx-0\" style=\"padding-left: 20px; padding-right: 20px;\">\n                      <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                        <tr>\n                          <td style=\"border-radius: 8px;\" bgcolor=\"#ffffff\">\n                            <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                              <tr>\n                                <td class=\"img-center py-15 px-18\"\n                                  style=\"border-radius: 8px 8px 0 0; font-size:0pt; line-height:0pt; text-align:center; padding-top: 15px; padding-bottom: 15px; padding-left: 18px; padding-right: 18px;\"\n                                  bgcolor=\"#3a4f6c\"><a href=\"https:\/\/{{shopify_1.myshopify_domain}}\/admin\/apps\/mesa?utm_source=mesa&utm_medium=email&utm_campaign=order_report_card&utm_campaign={{shopify_1.myshopify_domain}}\" target=\"_blank\"><img\n                                      src=\"https:\/\/images.prismic.io\/mesa\/c230dae9-7cbe-4558-85d6-5c123bccbae1_order_report_template_email_logo.jpg\"\n                                      width=\"110\" height=\"34\" border=\"0\" alt=\"\" \/><\/a><\/td>\n                              <\/tr>\n                              <tr>\n                                <td class=\"pt-32 px-18 pb-20\"\n                                  style=\"padding-top: 32px; padding-left: 18px; padding-right: 18px; padding-bottom: 20px;\">\n                                  <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                    <tr>\n                                      <td class=\"text-16 a-center pb-16\"\n                                        style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:center; padding-bottom: 16px;\">\n                                        MESA has generated your<\/td>\n                                    <\/tr>\n                                    <tr>\n                                      <td class=\"title-28 a-center pb-18\"\n                                        style=\"font-size:28px; line-height:32px; color:#42474e; font-family:Arial, sans-serif; font-weight:normal; min-width:auto !important; text-align:center; padding-bottom: 18px;\">\n                                        <strong>Order Report Card<\/strong><\/td>\n                                    <\/tr>\n                                    <tr>\n                                      <td class=\"text-16 a-center pb-28\"\n                                        style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:center; padding-bottom: 28px;\">\n                                        for {{'24 hours ago' | date: '%b %d %l:%M%P'}} - {{'now' | date: '%b %d %l:%M%P'}}<\/td>\n                                    <\/tr>\n                                    <tr>\n                                      <td class=\"pb-20\" style=\"padding-bottom: 20px;\">\n                                        <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                          <tr>\n                                            <td class=\"py-24 px-18\"\n                                              style=\"border-radius: 8px; padding-top: 24px; padding-bottom: 24px; padding-left: 18px; padding-right: 18px;\"\n                                              bgcolor=\"#daf2f4\">\n                                              <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                                <tr>\n                                                  <td class=\"pb-18\" style=\"padding-bottom: 18px;\">\n                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                                      <tr>\n                                                        <td class=\"text-16 w-70p\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; text-align:left; min-width:auto !important;\">\n                                                          Total Orders<\/td>\n                                                        <td class=\"img w-2p\" width=\"20\"\n                                                          style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n                                                        <td class=\"text-16 a-right w-28p\" width=\"80\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:right;\">\n                                                          <strong>{{transform_mapping.orders_total}}{% unless transform_mapping.orders_total %}0{% endunless %}<\/strong>\n                                                        <\/td>\n                                                      <\/tr>\n                                                    <\/table>\n                                                  <\/td>\n                                                <\/tr>\n                                                <tr>\n                                                  <td class=\"pb-18\" style=\"padding-bottom: 18px;\">\n                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                                      <tr>\n                                                        <td class=\"text-16 w-70p\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; text-align:left; min-width:auto !important;\">\n                                                          Total Orders Over $100<\/td>\n                                                        <td class=\"img w-2p\" width=\"20\"\n                                                          style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n                                                        <td class=\"text-16 a-right w-28p\" width=\"80\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:right;\">\n                                                          <strong>{{transform_mapping.orders_over_100}}{% unless transform_mapping.orders_over_100 %}0{% endunless %}<\/strong><\/td>\n                                                      <\/tr>\n                                                    <\/table>\n                                                  <\/td>\n                                                <\/tr>\n                                                <tr>\n                                                  <td class=\"pb-18\" style=\"padding-bottom: 18px;\">\n                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                                      <tr>\n                                                        <td class=\"text-16 w-70p\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; text-align:left; min-width:auto !important;\">\n                                                          Total Orders Paid<\/td>\n                                                        <td class=\"img w-2p\" width=\"20\"\n                                                          style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n                                                        <td class=\"text-16 a-right w-28p\" width=\"80\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:right;\">\n                                                          <strong>{{transform_mapping.orders_paid}}{% unless transform_mapping.orders_paid %}0{% endunless %}<\/strong>\n                                                        <\/td>\n                                                      <\/tr>\n                                                    <\/table>\n                                                  <\/td>\n                                                <\/tr>\n                                                <tr>\n                                                  <td class=\"pb-18\" style=\"padding-bottom: 18px;\">\n                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                                      <tr>\n                                                        <td class=\"text-16 w-70p\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; text-align:left; min-width:auto !important;\">\n                                                          Total Orders Pending Payment<\/td>\n                                                        <td class=\"img w-2p\" width=\"20\"\n                                                          style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n                                                        <td class=\"text-16 a-right w-28p\" width=\"80\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:right;\">\n                                                          <strong>{{transform_mapping.orders_pending}}{% unless transform_mapping.orders_pending %}0{% endunless %}<\/strong>\n                                                        <\/td>\n                                                      <\/tr>\n                                                    <\/table>\n                                                  <\/td>\n                                                <\/tr>\n                                                <tr>\n                                                  <td class=\"pb-18\" style=\"padding-bottom: 18px;\">\n                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                                      <tr>\n                                                        <td class=\"text-16 w-70p\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; text-align:left; min-width:auto !important;\">\n                                                          Total Orders Fulfilled<\/td>\n                                                        <td class=\"img w-2p\" width=\"20\"\n                                                          style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n                                                        <td class=\"text-16 a-right w-28p\" width=\"80\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:right;\">\n                                                          <strong>{{transform_mapping.orders_fulfilled}}{% unless transform_mapping.orders_fulfilled %}0{% endunless %}<\/strong><\/td>\n                                                      <\/tr>\n                                                    <\/table>\n                                                  <\/td>\n                                                <\/tr>\n                                                <tr>\n                                                  <td class=\"img\"\n                                                    style=\"font-size:0pt; line-height:0pt; text-align:left;\">\n                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                                      <tr>\n                                                        <td class=\"text-16 w-70p\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; text-align:left; min-width:auto !important;\">\n                                                          Most Popular Product(s) Sold<\/td>\n                                                        <td class=\"img w-2p\" width=\"20\"\n                                                          style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n                                                        <td class=\"text-16 a-right w-28p\" width=\"80\"\n                                                          style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; min-width:auto !important; text-align:right;\">\n                                                          <strong>{{transform_mapping.most_popular_product}}{% unless transform_mapping.most_popular_product %}None{% endunless %}<\/strong><\/td>\n                                                      <\/tr>\n                                                    <\/table>\n                                                  <\/td>\n                                                <\/tr>\n                                              <\/table>\n                                            <\/td>\n                                          <\/tr>\n                                        <\/table>\n                                      <\/td>\n                                    <\/tr>\n                                    <tr>\n                                      <td class=\"py-20 px-18\"\n                                        style=\"border-radius: 8px; padding-top: 20px; padding-bottom: 20px; padding-left: 18px; padding-right: 18px;\"\n                                        bgcolor=\"#f6f7f9\">\n                                        <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n                                          <tr>\n                                            <td class=\"text-16\"\n                                              style=\"font-size:16px; line-height:20px; color:#42474e; font-family:Arial, sans-serif; text-align:left; min-width:auto !important;\">\n                                              Want to customize this Order Report Card or disable it? <a\n                                                href=\"https:\/\/app.getmesa.com\/automations\/{{transform_mapping.workflow_id}}?uuid={{shopify_1.shop.myshopify_domain | replace: \".myshopify.com\", \"\"}}\"\n                                                target=\"_blank\" class=\"link-u\"\n                                                style=\"color:#42474e; text-decoration:underline;\"><span class=\"link-u\"\n                                                  style=\"color:#42474e; text-decoration:underline;\">Click\n                                                  here<\/span><\/a>.<\/td>\n                                          <\/tr>\n                                        <\/table>\n                                      <\/td>\n                                    <\/tr>\n                                  <\/table>\n                                <\/td>\n                              <\/tr>\n                            <\/table>\n                          <\/td>\n                        <\/tr>\n                      <\/table>\n                    <\/td>\n                  <\/tr>\n                <\/table>\n              <\/td>\n            <\/tr>\n          <\/table>\n        <\/td>\n      <\/tr>\n    <\/table>\n  <\/center>\n<\/body>\n\n<\/html>",
                        "advanced_options": {
                            "from": "MESA <contact@getmesa.com>"
                        }
                    }
                },
                "local_fields": [],
                "selected_fields": [
                    "body.advanced_options.from"
                ],
                "on_error": "default",
                "weight": 3
            }
        ]
    }
}
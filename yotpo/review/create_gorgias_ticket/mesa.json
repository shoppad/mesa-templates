{
    "key": "yotpo/review/create_gorgias_ticket",
    "name": "Create a Gorgias support ticket when a customer leaves a negative Yotpo review",
    "version": "1.0.0",
    "enabled": false,
    "setup": true,
    "config": {
        "inputs": [
            {
                "schema": 4,
                "trigger_type": "input",
                "type": "yotpo",
                "entity": "review",
                "action": "created",
                "name": "Review Created",
                "key": "yotpo_review",
                "operation_id": "review_create",
                "metadata": [],
                "local_fields": [],
                "selected_fields": [],
                "on_error": "default",
                "weight": 0
            }
        ],
        "outputs": [
            {
                "schema": 2,
                "trigger_type": "output",
                "type": "filter",
                "name": "Filter",
                "key": "filter",
                "metadata": {
                    "a": "{{yotpo_review.score}}",
                    "comparison": "less than equal",
                    "b": "3"
                },
                "local_fields": [],
                "selected_fields": ["a", "comparison", "b"],
                "on_error": "default",
                "weight": 0
            },
            {
                "schema": 4,
                "trigger_type": "output",
                "type": "gorgias",
                "entity": "ticket",
                "action": "create",
                "name": "Create Ticket",
                "version": "v2",
                "key": "gorgias_ticket",
                "operation_id": "create_ticket",
                "metadata": {
                    "api_endpoint": "post /api/tickets",
                    "body": {
                        "channel": "api",
                        "messages": [
                            {
                                "body_html": "Review for {{yotpo_review.title}} with a score of {{yotpo_review.score}}",
                                "body_text": "Review for {{yotpo_review.title}} given a rating of {{yotpo_review.score}}",
                                "channel": "email",
                                "from_agent": "false",
                                "subject": "Sorry for Your Poor Experience",
                                "via": "email",
                                "sender": {
                                    "email": "{{yotpo_review.customer_email}}"
                                },
                                "source": {
                                    "to": [
                                        {
                                            "address": "{{yotpo_review.customer_email}}"
                                        }
                                    ],
                                    "from": {
                                        "address": "{{yotpo_review.customer_email}}"
                                    }
                                }
                            }
                        ],
                        "customer": {
                            "email": "{{yotpo_review.customer_email}}"
                        }
                    }
                },
                "local_fields": [],
                "selected_fields": [
                    "body",
                    "body.channel",
                    "body.customer",
                    "body.customer.email",
                    "body.messages",
                    "body.messages[].body_html",
                    "body.messages[].body_text",
                    "body.messages[].channel",
                    "body.messages[].from_agent",
                    "body.messages[].sender",
                    "body.messages[].sender.email",
                    "body.messages[].source",
                    "body.messages[].source.from",
                    "body.messages[].source.from.address",
                    "body.messages[].source.to",
                    "body.messages[].source.to[].address",
                    "body.messages[].subject",
                    "body.messages[].via"
                ],
                "on_error": "default",
                "weight": 1
            }
        ]
    }
}
